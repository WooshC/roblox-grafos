<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GUIExplorador v2 ‚Äî An√°lisis Mejorado</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Rajdhani:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-void:    #080a0f;
  --bg-deep:    #0d1017;
  --bg-surface: #12151e;
  --bg-card:    #1a1e2a;
  --bg-glass:   rgba(255,255,255,.04);
  --border:     rgba(255,255,255,.07);
  --border-hi:  rgba(255,255,255,.13);
  --text-1:     #e8eef5;
  --text-2:     #6a7a8a;
  --text-3:     #3a4a5a;

  --vis:   #3ecf8e;
  --mat:   #4b9de8;
  --ana:   #e8934b;
  --mis:   #7b6ef6;
  --gold:  #f5c842;
  --pts:   #4b9de8;
  --money: #3ecf8e;
  --danger:#e05c5c;
  --ok:    #3ecf8e;
  --warn:  #e8c24b;

  --font-ui:   'Rajdhani', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --font-code: 'Space Mono', monospace;
}

body {
  background: #060809;
  display: flex; flex-direction: column; align-items: center;
  padding: 20px 16px; gap: 14px;
  font-family: var(--font-ui);
  min-height: 100vh;
  color: var(--text-1);
}

/* META CONTROLS */
.meta-controls {
  display: flex; gap: 6px; flex-wrap: wrap; justify-content: center;
  background: var(--bg-card);
  border: 1px solid var(--border-hi);
  border-radius: 10px;
  padding: 8px 14px;
  width: 100%; max-width: 1040px;
}
.meta-controls span { color: var(--text-2); font-size: 11px; align-self: center; letter-spacing:.05em; }
.meta-btn {
  background: var(--bg-surface);
  border: 1px solid var(--border-hi);
  color: var(--text-2);
  padding: 5px 13px; border-radius: 7px;
  cursor: pointer; font-size: 11px; font-family: var(--font-ui);
  font-weight: 600; letter-spacing:.04em;
  transition: all .15s;
}
.meta-btn:hover { background: var(--bg-glass); color: var(--text-1); border-color: rgba(255,255,255,.2); }
.meta-btn.active { background: rgba(91,143,255,.15); color: #7b9fff; border-color: rgba(91,143,255,.4); }

/* VIEWPORT */
.viewport {
  position: relative;
  width: 1040px; max-width: 100%;
  aspect-ratio: 16/9;
  background: var(--bg-void);
  border-radius: 14px; overflow: hidden;
  border: 1px solid var(--border-hi);
  box-shadow: 0 0 80px rgba(0,0,0,.9), 0 0 0 1px rgba(255,255,255,.04);
  user-select: none;
}

/* WORLD BG */
.world-bg {
  position: absolute; inset: 0;
  background: radial-gradient(ellipse 70% 60% at 50% 65%, rgba(20,50,80,.25) 0%, transparent 70%),
              linear-gradient(180deg, #0c1520 0%, #080e16 50%, #04090e 100%);
  display: flex; align-items: center; justify-content: center;
  pointer-events: none;
}
.world-svg-hint { opacity: .09; }

/* SCANLINE overlay */
.world-bg::after {
  content: '';
  position: absolute; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,.04) 2px, rgba(0,0,0,.04) 4px);
  pointer-events: none;
}

/* CHROME BAR */
.roblox-chrome {
  position: absolute; top: 0; left: 0; right: 0; height: 30px;
  background: rgba(0,0,0,.6); backdrop-filter: blur(10px);
  display: flex; align-items: center; gap: 18px; justify-content: center;
  border-bottom: 1px solid var(--border);
  z-index: 5;
}
.rb-dot { width: 7px; height: 7px; border-radius: 50%; background: rgba(255,255,255,.15); }

/* TOP BAR */
.top-bar {
  position: absolute; top: 30px; left: 0; right: 0; height: 52px;
  background: rgba(8,10,15,.92); backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 12px; gap: 10px;
  z-index: 20;
}

.title-badge {
  display: flex; align-items: center; gap: 8px;
  background: rgba(255,255,255,.04); border: 1px solid var(--border-hi);
  border-radius: 8px; padding: 5px 11px; flex-shrink: 0;
}
.title-badge .icon { font-size: 15px; }
.title-badge .name { font-size: 13px; font-weight: 700; color: var(--text-1); letter-spacing:.04em; line-height:1; }
.title-badge .sub  { font-size: 9px; color: var(--text-2); letter-spacing:.1em; text-transform:uppercase; }

.score-strip { display:flex; gap:5px; flex:1; justify-content:center; }
.score-chip {
  display:flex; align-items:center; gap:6px;
  background: rgba(255,255,255,.04); border: 1px solid var(--border);
  border-radius: 7px; padding: 4px 10px; min-width: 78px;
}
.score-chip .ic { font-size:12px; }
.score-chip .val { font-size:13px; font-weight:700; color:var(--text-1); font-family:var(--font-mono); }
.score-chip .lbl { font-size:8px; color:var(--text-2); text-transform:uppercase; letter-spacing:.08em; }
.score-chip.stars .val { color:var(--gold); letter-spacing:2px; }
.score-chip.pts   .val { color:var(--pts); }
.score-chip.money .val { color:var(--money); }

.action-btns { display:flex; gap:5px; flex-shrink:0; }
.action-btn {
  display:flex; align-items:center; gap:5px;
  border:none; border-radius:7px; padding: 5px 12px;
  font-size:11px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; letter-spacing:.05em; transition: filter .15s, transform .1s;
}
.action-btn:hover { filter:brightness(1.2); transform:translateY(-1px); }
.action-btn.restart { background:rgba(232,194,75,.15); color:var(--warn); border:1px solid rgba(232,194,75,.3); }
.action-btn.finish  { background:rgba(62,207,142,.18); color:var(--ok); border:1px solid rgba(62,207,142,.35); }

/* MAIN BTN BAR ‚Äî solo visible fuera del mapa */
.main-bar {
  position: absolute; top: 88px; left: 12px;
  display: flex; gap: 5px;
  background: rgba(8,10,15,.88); backdrop-filter: blur(12px);
  border: 1px solid var(--border-hi); border-radius: 10px; padding: 5px;
  z-index: 20;
}
.main-btn {
  display:flex; align-items:center; gap:5px;
  background: rgba(255,255,255,.05); border: 1px solid var(--border);
  border-radius: 7px; padding: 6px 13px;
  font-size: 11px; font-weight: 700; font-family: var(--font-ui);
  cursor: pointer; color: var(--text-1); letter-spacing:.05em;
  transition: all .18s; white-space:nowrap;
}
.main-btn:hover { background: rgba(255,255,255,.09); border-color: var(--border-hi); transform:translateY(-1px); }
.main-btn.vis  { color:var(--vis); border-color:rgba(62,207,142,.25); }
.main-btn.mat  { color:var(--mat); border-color:rgba(75,157,232,.25); }
.main-btn.ana  { color:var(--ana); border-color:rgba(232,147,75,.25); }
.main-btn.mis  { color:var(--mis); border-color:rgba(123,110,246,.25); }
.main-btn.vis:hover { background:rgba(62,207,142,.1); }
.main-btn.mat:hover { background:rgba(75,157,232,.1); }
.main-btn.ana:hover { background:rgba(232,147,75,.1); }
.main-btn.mis:hover { background:rgba(123,110,246,.1); }

/* MODE SELECTOR */
.mode-sel {
  position:absolute; bottom:12px; left:12px;
  display:flex; gap:3px;
  background:rgba(8,10,15,.9); backdrop-filter:blur(10px);
  border:1px solid var(--border-hi); border-radius:10px; padding:4px;
  z-index:20;
}
.mode-btn {
  display:flex; align-items:center; gap:5px;
  background:transparent; border:1px solid transparent; border-radius:7px;
  padding:6px 13px; font-size:10px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; color:var(--text-2); letter-spacing:.08em; text-transform:uppercase;
  transition: all .18s;
}
.mode-btn:hover { color:var(--text-1); background:rgba(255,255,255,.05); }
.mode-btn.active-vis { color:var(--vis); background:rgba(62,207,142,.12); border-color:rgba(62,207,142,.3); }
.mode-btn.active-mat { color:var(--mat); background:rgba(75,157,232,.12); border-color:rgba(75,157,232,.3); }
.mode-btn.active-ana { color:var(--ana); background:rgba(232,147,75,.12); border-color:rgba(232,147,75,.3); }
.mode-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; background:rgba(255,255,255,.2); }
.mode-btn.active-vis .mode-dot { background:var(--vis); box-shadow:0 0 5px var(--vis); }
.mode-btn.active-mat .mode-dot { background:var(--mat); box-shadow:0 0 5px var(--mat); }
.mode-btn.active-ana .mode-dot { background:var(--ana); box-shadow:0 0 5px var(--ana); }

/* MINIMAP */
.minimap {
  position:absolute; bottom:12px; right:12px;
  width:200px;
  background:rgba(8,10,15,.92); backdrop-filter:blur(14px);
  border:1px solid rgba(62,207,142,.2); border-radius:10px; overflow:hidden;
  z-index:20;
}
.minimap-header {
  padding:6px 10px;
  background:rgba(62,207,142,.08); border-bottom:1px solid rgba(62,207,142,.15);
  font-size:9px; font-weight:700; color:var(--vis); text-transform:uppercase; letter-spacing:.1em;
  display:flex; align-items:center; gap:5px;
}
.minimap-header::before { content:''; width:4px; height:4px; border-radius:50%; background:var(--vis); box-shadow:0 0 5px var(--vis); flex-shrink:0; }
.minimap-viewport { height:130px; background:radial-gradient(ellipse at center, #0e2030 0%, #04090f 100%); position:relative; }
.minimap-footer {
  padding:7px 9px; display:grid; grid-template-columns:1fr 1fr; gap:5px;
}
.map-stat { background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:5px; padding:4px 6px; }
.map-stat .k { font-size:7px; color:var(--text-2); text-transform:uppercase; letter-spacing:.06em; }
.map-stat .v { font-size:12px; font-weight:700; color:var(--text-1); font-family:var(--font-mono); }

/* MISSIONS */
.missions-panel {
  position:absolute; top:134px; left:12px;
  width:220px; max-height: calc(100% - 154px);
  background:rgba(8,10,15,.93); backdrop-filter:blur(14px);
  border:1px solid rgba(123,110,246,.25); border-radius:10px;
  overflow:hidden; z-index:25; display:flex; flex-direction:column;
}
.missions-header {
  padding:8px 10px;
  background:rgba(123,110,246,.1); border-bottom:1px solid rgba(123,110,246,.2);
  font-size:10px; font-weight:700; color:var(--mis); text-transform:uppercase; letter-spacing:.07em;
  display:flex; align-items:center; justify-content:space-between;
}
.close-btn {
  width:20px; height:20px; background:rgba(224,92,92,.18); border:1px solid rgba(224,92,92,.3);
  border-radius:5px; color:var(--danger); font-size:10px;
  display:flex; align-items:center; justify-content:center; cursor:pointer;
}
.close-btn:hover { background:rgba(224,92,92,.35); }
.missions-body { padding:7px; overflow-y:auto; flex:1; display:flex; flex-direction:column; gap:5px; }
.zone-label { font-size:8px; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em; padding:0 3px; margin-top:3px; }
.mission-item {
  display:flex; align-items:flex-start; gap:6px;
  background:rgba(255,255,255,.03); border:1px solid var(--border);
  border-radius:6px; padding:6px 8px; font-size:10px; color:var(--text-1); line-height:1.4;
}
.mission-item.done { color:rgba(255,255,255,.35); }
.mission-item.done .m-check { color:var(--ok); }
.m-check { flex-shrink:0; font-size:12px; margin-top:1px; }
.bonus-sep { font-size:8px; color:var(--gold); text-transform:uppercase; letter-spacing:.1em; padding:3px 3px 0; display:flex; align-items:center; gap:5px; }
.bonus-sep::before, .bonus-sep::after { content:''; flex:1; height:1px; background:rgba(245,200,66,.18); }

/* LEGEND */
.legend {
  position:absolute; bottom:70px; right:12px;
  background:rgba(8,10,15,.88); border:1px solid var(--border-hi);
  border-radius:7px; padding:7px 9px; z-index:18;
  display:flex; flex-direction:column; gap:3px;
}
.legend-title { font-size:7px; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em; margin-bottom:2px; }
.legend-row { display:flex; align-items:center; gap:6px; font-size:8px; color:var(--text-2); }
.dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ANALYSIS OVERLAY ‚Äî VERSI√ìN MEJORADA
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.analysis-overlay {
  position:absolute; inset:0;
  background:rgba(0,0,0,.82);
  backdrop-filter:blur(6px);
  z-index:30;
  display:flex; align-items:center; justify-content:center;
  padding: 10px;
}

.analysis-panel {
  width: 900px; max-width:100%; height: 480px;
  background:rgba(10,12,18,.97);
  border:1px solid rgba(232,147,75,.25);
  border-radius:14px; overflow:hidden;
  box-shadow: 0 0 60px rgba(232,147,75,.08), 0 30px 80px rgba(0,0,0,.9);
  display:flex; flex-direction:column;
}

.analysis-head {
  background: linear-gradient(135deg, rgba(232,147,75,.25) 0%, rgba(180,100,20,.15) 100%);
  border-bottom:1px solid rgba(232,147,75,.2);
  padding:10px 14px;
  display:flex; align-items:center; gap:10px; flex-shrink:0;
}
.analysis-head .ah-title { font-size:15px; font-weight:700; color:var(--ana); letter-spacing:.05em; font-family:var(--font-ui); }
.analysis-head .ah-sub   { font-size:9px; color:var(--text-2); letter-spacing:.1em; text-transform:uppercase; margin-top:1px; }
.analysis-head .spacer   { flex:1; }
.analysis-close {
  width:26px; height:26px; background:rgba(224,92,92,.18); border:1px solid rgba(224,92,92,.3);
  border-radius:7px; color:var(--danger); font-size:12px;
  display:flex; align-items:center; justify-content:center; cursor:pointer;
  flex-shrink:0;
}
.analysis-close:hover { background:rgba(224,92,92,.35); }

/* ALGO SELECTOR PILLS */
.algo-pills {
  display:flex; gap:4px; flex-shrink:0;
}
.algo-pill {
  background: rgba(255,255,255,.05); border:1px solid var(--border-hi);
  border-radius:20px; padding: 4px 12px;
  font-size:10px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; color:var(--text-2); letter-spacing:.05em; text-transform:uppercase;
  transition: all .15s;
}
.algo-pill:hover { color:var(--text-1); background:rgba(255,255,255,.09); }
.algo-pill.active-bfs  { color:var(--mat); background:rgba(75,157,232,.18); border-color:rgba(75,157,232,.45); box-shadow:0 0 10px rgba(75,157,232,.2); }
.algo-pill.active-dfs  { color:var(--vis); background:rgba(62,207,142,.18); border-color:rgba(62,207,142,.45); box-shadow:0 0 10px rgba(62,207,142,.2); }
.algo-pill.active-dijkstra { color:var(--gold); background:rgba(245,200,66,.15); border-color:rgba(245,200,66,.4); box-shadow:0 0 10px rgba(245,200,66,.15); }
.algo-pill.active-prim { color:var(--mis); background:rgba(123,110,246,.18); border-color:rgba(123,110,246,.45); box-shadow:0 0 10px rgba(123,110,246,.2); }

/* ANALYSIS BODY ‚Äî 3 columnas */
.analysis-body {
  flex:1; display:flex; overflow:hidden;
}

/* ‚îÄ‚îÄ COL 1: Graph minimap del grafo de la zona ‚îÄ‚îÄ */
.graph-col {
  width: 260px; flex-shrink:0;
  border-right:1px solid var(--border);
  display:flex; flex-direction:column;
  background: rgba(4,8,14,.5);
}
.graph-col-header {
  padding:8px 10px; flex-shrink:0;
  background:rgba(255,255,255,.03); border-bottom:1px solid var(--border);
  font-size:9px; font-weight:700; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em;
  display:flex; align-items:center; gap:6px;
}
.zone-badge {
  background:rgba(232,147,75,.15); border:1px solid rgba(232,147,75,.3);
  border-radius:4px; padding:1px 6px; font-size:8px; color:var(--ana);
}
.graph-canvas-wrap {
  flex:1; position:relative; overflow:hidden;
  display:flex; align-items:center; justify-content:center;
}
.graph-canvas-wrap svg { width:100%; height:100%; }
.graph-controls {
  padding:7px 8px; flex-shrink:0; border-top:1px solid var(--border);
  display:flex; gap:5px; justify-content:center;
}
.graph-ctrl-btn {
  background:rgba(255,255,255,.05); border:1px solid var(--border-hi);
  border-radius:5px; padding:4px 10px; font-size:9px; font-weight:700;
  font-family:var(--font-ui); cursor:pointer; color:var(--text-2); letter-spacing:.05em;
  transition: all .15s;
}
.graph-ctrl-btn:hover { color:var(--text-1); background:rgba(255,255,255,.09); }
.graph-ctrl-btn.sel { color:var(--ana); border-color:rgba(232,147,75,.4); background:rgba(232,147,75,.1); }

/* NODE TOOLTIP */
.node-tooltip {
  position:absolute; top:8px; left:8px;
  background:rgba(8,10,15,.95); border:1px solid rgba(232,147,75,.3);
  border-radius:6px; padding:6px 8px;
  font-size:9px; color:var(--text-1); line-height:1.6; font-family:var(--font-mono);
  pointer-events:none; display:none;
}
.node-tooltip .nt-name { color:var(--ana); font-weight:700; font-size:11px; margin-bottom:3px; }

/* ‚îÄ‚îÄ COL 2: Step indicator + state data ‚îÄ‚îÄ */
.step-col {
  flex:1; display:flex; flex-direction:column; overflow:hidden;
  border-right:1px solid var(--border);
}
.step-col-header {
  padding:8px 10px; flex-shrink:0;
  background:rgba(255,255,255,.03); border-bottom:1px solid var(--border);
  font-size:9px; font-weight:700; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em;
}

.step-scroll { flex:1; overflow-y:auto; padding:9px; display:flex; flex-direction:column; gap:7px; }

.step-card {
  background:rgba(255,255,255,.04); border:1px solid var(--border-hi);
  border-radius:8px; padding:9px 11px;
  font-size:11px; color:var(--text-1); line-height:1.5;
}
.step-card .step-n { color:var(--ana); font-weight:700; font-family:var(--font-mono); font-size:10px; margin-bottom:4px; }
.step-card strong { color:var(--mat); }

.state-table {
  width:100%; border-collapse:collapse; font-size:10px; font-family:var(--font-mono);
}
.state-table th {
  padding:5px 7px; background:rgba(75,157,232,.08); border:1px solid var(--border);
  color:var(--mat); font-size:8px; text-transform:uppercase; letter-spacing:.08em; text-align:left;
}
.state-table td {
  padding:5px 7px; border:1px solid var(--border);
  color:var(--text-1); vertical-align:top;
}
.state-table tr:hover td { background:rgba(255,255,255,.03); }
.hi  { color:var(--ana); font-weight:700; }
.vis { color:var(--vis); font-weight:600; }
.dim { color:var(--text-3); }

/* traversal path bar */
.path-bar {
  margin:0 9px; flex-shrink:0;
  background:rgba(4,8,14,.7); border:1px solid var(--border);
  border-radius:7px; padding:8px 10px;
}
.path-bar .pb-label { font-size:8px; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em; margin-bottom:5px; }
.path-nodes { display:flex; flex-wrap:wrap; gap:4px; align-items:center; }
.path-node {
  padding:2px 8px; border-radius:4px; font-size:10px; font-weight:700;
  font-family:var(--font-mono); border:1px solid;
}
.path-node.visited { color:var(--vis); border-color:rgba(62,207,142,.4); background:rgba(62,207,142,.1); }
.path-node.current { color:var(--ana); border-color:rgba(232,147,75,.6); background:rgba(232,147,75,.2); box-shadow:0 0 8px rgba(232,147,75,.3); }
.path-node.queued  { color:var(--mat); border-color:rgba(75,157,232,.35); background:rgba(75,157,232,.08); }
.path-arrow { color:var(--text-3); font-size:11px; }

.step-controls {
  padding:8px 9px; flex-shrink:0; border-top:1px solid var(--border);
  display:flex; gap:6px; align-items:center;
}
.step-progress {
  flex:1; height:3px; background:rgba(255,255,255,.08); border-radius:99px; overflow:hidden;
}
.step-progress-fill {
  height:100%; background:linear-gradient(90deg, var(--ana), var(--gold));
  border-radius:99px; transition: width .3s ease;
  width: 45%;
}
.ctrl-btn {
  display:flex; align-items:center; gap:5px;
  border:none; border-radius:7px; padding: 6px 14px;
  font-size:10px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; transition: filter .15s, transform .1s; letter-spacing:.05em;
}
.ctrl-btn:hover { filter:brightness(1.18); transform:translateY(-1px); }
.ctrl-btn.prev { background:rgba(106,122,138,.15); color:var(--text-2); border:1px solid rgba(106,122,138,.25); }
.ctrl-btn.next { background:rgba(232,147,75,.2); color:var(--ana); border:1px solid rgba(232,147,75,.35); }
.ctrl-btn.exit { background:rgba(224,92,92,.15); color:var(--danger); border:1px solid rgba(224,92,92,.3); }

/* ‚îÄ‚îÄ COL 3: Pseudocode + metrics ‚îÄ‚îÄ */
.code-col {
  width: 230px; flex-shrink:0;
  display:flex; flex-direction:column;
}
.code-col-header {
  padding:8px 10px; flex-shrink:0;
  background:rgba(255,255,255,.03); border-bottom:1px solid var(--border);
  font-size:9px; font-weight:700; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em;
}
.pseudocode {
  flex:1; overflow-y:auto; padding:9px;
  font-family:var(--font-code); font-size:9.5px; line-height:1.9;
  color:var(--text-2);
}
.pc-line { display:flex; gap:0; padding:1px 0; transition:background .12s; border-radius:3px; }
.pc-line.active { background:rgba(232,147,75,.15); }
.pc-ln { color:var(--text-3); min-width:22px; flex-shrink:0; padding-right:8px; text-align:right; font-size:8.5px; }
.pc-code { flex:1; }
.kw { color:var(--mat); }
.fn { color:var(--vis); }
.cmt { color:var(--text-3); font-style:italic; }
.str { color:var(--gold); }
.hl { color:var(--ana); font-weight:700; }

.metrics-box {
  padding:8px 9px; flex-shrink:0; border-top:1px solid var(--border);
  display:flex; flex-direction:column; gap:5px;
}
.metric-row { display:flex; justify-content:space-between; align-items:center; }
.metric-row .mk { font-size:9px; color:var(--text-2); }
.metric-row .mv { font-size:11px; font-weight:700; font-family:var(--font-mono); color:var(--text-1); }
.metric-row .mv.green { color:var(--vis); }
.metric-row .mv.orange { color:var(--ana); }
.complexity-badge {
  background:rgba(75,157,232,.12); border:1px solid rgba(75,157,232,.25);
  border-radius:5px; padding:3px 8px; font-size:10px; font-weight:700;
  font-family:var(--font-mono); color:var(--mat); text-align:center;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PANTALLA DE MAPA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.map-screen {
  position:absolute; top:82px; left:0; right:0; bottom:0;
  background:rgba(5,8,14,.97); backdrop-filter:blur(6px);
  z-index:13; display:flex; flex-direction:column;
}
.map-screen-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:9px 14px;
  background:rgba(255,255,255,.03);
  border-bottom:1px solid var(--border-hi);
  flex-shrink:0;
}
.map-screen-title {
  font-size:12px; font-weight:700; color:var(--text-1);
  letter-spacing:.06em; text-transform:uppercase;
  display:flex; align-items:center; gap:8px;
}
.map-screen-title::before {
  content:''; width:6px; height:6px; border-radius:50%;
  background:var(--vis); box-shadow:0 0 6px var(--vis); flex-shrink:0;
}
.map-screen-btns { display:flex; gap:6px; }
.map-action-btn {
  display:flex; align-items:center; gap:5px;
  background:rgba(255,255,255,.05); border:1px solid var(--border-hi);
  border-radius:7px; padding:5px 12px;
  font-size:10px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; color:var(--text-2); letter-spacing:.05em;
  transition:all .15s; text-transform:uppercase;
}
.map-action-btn:hover { color:var(--text-1); background:rgba(255,255,255,.1); }
.map-action-btn.mis  { color:var(--mis); border-color:rgba(123,110,246,.3); }
.map-action-btn.mis:hover  { background:rgba(123,110,246,.12); }
.map-action-btn.mat  { color:var(--mat); border-color:rgba(75,157,232,.3); }
.map-action-btn.mat:hover  { background:rgba(75,157,232,.12); }
.map-action-btn.cls  { color:var(--danger); border-color:rgba(224,92,92,.3); }
.map-action-btn.cls:hover  { background:rgba(224,92,92,.12); }
/* Sub-header info strip */
.map-info-strip {
  display:flex; gap:12px; align-items:center;
  padding:6px 14px;
  background:rgba(62,207,142,.04);
  border-bottom:1px solid rgba(62,207,142,.1);
  flex-shrink:0;
}
.map-info-pill {
  display:flex; align-items:center; gap:5px;
  font-size:9px; color:var(--text-2);
}
.map-info-pill strong { color:var(--text-1); font-family:var(--font-mono); }
/* Large map canvas */
.map-canvas {
  flex:1; display:flex; align-items:center; justify-content:center;
  position:relative; overflow:hidden;
  /* right padding to avoid matrix panel overlap when in matematico mode */
}
.map-canvas.with-matrix { padding-right:270px; }
.map-canvas svg { max-width:94%; max-height:94%; }

/* MATRIX PANEL */
.matrix-panel {
  position:absolute; top:90px; right:12px; bottom:12px; width:260px;
  background:rgba(8,10,15,.93); backdrop-filter:blur(14px);
  border:1px solid rgba(75,157,232,.22); border-radius:10px; overflow:hidden;
  z-index:20; display:flex; flex-direction:column;
}
.matrix-header {
  padding:8px 11px; background:rgba(75,157,232,.08); border-bottom:1px solid rgba(75,157,232,.18);
  font-size:10px; font-weight:700; color:var(--mat); text-transform:uppercase; letter-spacing:.07em;
  display:flex; align-items:center; gap:5px;
}
.node-info {
  margin:7px; background:rgba(75,157,232,.07); border:1px solid rgba(75,157,232,.18);
  border-radius:7px; padding:7px 9px;
  display:grid; grid-template-columns:1fr 1fr; gap:3px;
}
.ni-row { display:flex; justify-content:space-between; font-size:9px; }
.ni-row .k { color:var(--text-2); }
.ni-row .v { color:var(--mat); font-weight:700; font-family:var(--font-mono); font-size:10px; }
.matrix-scroll { flex:1; overflow:auto; padding:7px; }
.matrix-grid { display:inline-grid; gap:2px; }
.cell {
  width:24px; height:24px; border-radius:3px; font-size:9px; font-weight:700;
  font-family:var(--font-mono); display:flex; align-items:center; justify-content:center;
  cursor:pointer; transition: filter .12s;
}
.cell:hover { filter:brightness(1.3); }
.cell.header { background:rgba(52,140,210,.45); color:#fff; font-size:8px; }
.cell.diag   { background:rgba(30,30,40,.8); color:rgba(255,255,255,.18); cursor:default; }
.cell.c1     { background:rgba(62,207,142,.55); color:#fff; }
.cell.c0     { background:rgba(40,45,60,.7); color:rgba(255,255,255,.2); }
.cell.sel-row { filter:brightness(1.35) saturate(1.4); outline:1px solid var(--gold); }

/* VICTORY */
.victory-overlay {
  position:absolute; inset:0; background:rgba(0,0,0,.88); backdrop-filter:blur(8px);
  z-index:40; display:flex; align-items:center; justify-content:center;
}
.victory-panel {
  width:420px; background:rgba(12,14,20,.98);
  border:1px solid rgba(245,200,66,.22); border-radius:18px; overflow:hidden;
  box-shadow: 0 0 100px rgba(245,200,66,.12), 0 30px 80px rgba(0,0,0,.9);
}
.victory-head { background:linear-gradient(135deg, rgba(245,200,66,.18), rgba(200,140,0,.1) 100%); border-bottom:1px solid rgba(245,200,66,.18); padding:18px; text-align:center; }
.victory-title { font-size:24px; font-weight:900; color:var(--gold); letter-spacing:.08em; font-family:var(--font-ui); text-shadow:0 0 30px rgba(245,200,66,.4); }
.victory-sub   { font-size:10px; color:var(--text-2); text-transform:uppercase; letter-spacing:.15em; margin-top:3px; }
.stars-row { display:flex; justify-content:center; gap:10px; margin-top:14px; }
.star-icon { font-size:32px; filter:drop-shadow(0 0 8px rgba(245,200,66,.5)); }
.star-icon.dim { filter:grayscale(1) opacity(.25); }
.victory-stats { padding:14px 18px; display:flex; flex-direction:column; gap:7px; }
.stat-row { display:flex; justify-content:space-between; align-items:center; padding:7px 11px; background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:7px; }
.stat-row .sk { font-size:11px; color:var(--text-2); }
.stat-row .sv { font-size:13px; font-weight:700; color:var(--text-1); font-family:var(--font-mono); }
.stat-row .sv.gold { color:var(--gold); font-size:17px; }
.victory-btns { padding:0 18px 18px; display:flex; gap:9px; }
.v-btn {
  flex:1; padding:10px; border:none; border-radius:9px;
  font-size:12px; font-weight:700; font-family:var(--font-ui);
  cursor:pointer; transition: filter .15s, transform .1s; letter-spacing:.05em;
}
.v-btn:hover { filter:brightness(1.15); transform:translateY(-1px); }
.v-btn.repeat { background:rgba(232,194,75,.18); color:var(--warn); border:1px solid rgba(232,194,75,.3); }
.v-btn.next   { background:linear-gradient(135deg, rgba(62,207,142,.75), rgba(30,140,80,.75)); color:#fff; }

/* NOTIFS */
.notif-stack { position:absolute; top:96px; right:12px; display:flex; flex-direction:column; gap:5px; z-index:22; pointer-events:none; width:190px; }
.notif { background:rgba(8,10,15,.92); border-radius:7px; padding:7px 10px; font-size:10px; display:flex; align-items:center; gap:7px; border-left:2px solid; backdrop-filter:blur(8px); }
.notif.success { border-color:var(--ok); }
.notif.info    { border-color:var(--mis); color:var(--text-1); }
.notif .ni-text { color:var(--text-1); }

/* GUIDE HUD */
.guide-hud {
  position:absolute; top:142px; left:50%; transform:translateX(-50%);
  background:rgba(245,200,66,.08); border:1px solid rgba(245,200,66,.28);
  border-radius:18px; padding:4px 13px; font-size:9px; color:var(--gold); font-weight:700;
  display:flex; align-items:center; gap:5px; z-index:18;
  animation: pulse-guide 2s ease-in-out infinite;
}
@keyframes pulse-guide { 0%,100%{opacity:.65} 50%{opacity:1; box-shadow:0 0 12px rgba(245,200,66,.2);} }
.guide-dot { width:5px; height:5px; border-radius:50%; background:var(--gold); box-shadow:0 0 5px var(--gold); }

/* SCROLLBARS */
::-webkit-scrollbar { width:3px; height:3px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,.12); border-radius:3px; }

.hidden { display:none !important; }

/* Graph node interaction */
.graph-node { cursor: pointer; }
.graph-node circle { transition: r .15s, filter .15s; }
.graph-node:hover circle { filter: brightness(1.4); }
.edge-path { transition: stroke-opacity .15s; }
</style>
</head>
<body>

<!-- META CONTROLS -->
<div class="meta-controls">
  <span>Vista previa:</span>
  <button class="meta-btn active" onclick="setMode('visual')">üëÅÔ∏è Visual</button>
  <button class="meta-btn" onclick="setMode('matrix')">üìã Matriz</button>
  <button class="meta-btn" onclick="setMode('analysis')">üéØ An√°lisis</button>
  <button class="meta-btn" onclick="setMode('victory')">üèÜ Victoria</button>
  <span style="margin-left:6px">|</span>
  <button class="meta-btn" id="btnMissions" onclick="toggleMissions()">üìå Misiones</button>
  <button class="meta-btn" id="btnGuide" onclick="toggleGuide()">üß≠ Gu√≠a</button>
  <button class="meta-btn" id="btnNotif" onclick="toggleNotifs()">üîî Notifs</button>
  <span style="margin-left:6px">|</span>
  <span style="color:rgba(255,255,255,.3);font-size:10px">Modo:</span>
  <button class="meta-btn" onclick="setMode('visual')">üëÅÔ∏è Visual</button>
  <button class="meta-btn" onclick="setMode('matematico')">üìã Matem√°tico</button>
  <button class="meta-btn" onclick="setMode('analysis')">üéØ An√°lisis</button>
  <button class="meta-btn" onclick="setMode('victory')">üèÜ Victoria</button>
  <span style="margin-left:6px">|</span>
  <span style="color:rgba(255,255,255,.3);font-size:10px">Mapa:</span>
  <button class="meta-btn" onclick="toggleMapa()">üó∫Ô∏è Toggle Mapa</button>
</div>

<!-- VIEWPORT -->
<div class="viewport" id="vp">

  <!-- World BG -->
  <div class="world-bg">
    <svg class="world-svg-hint" width="520" height="260" viewBox="0 0 520 260">
      <line x1="115" y1="115" x2="250" y2="62"  stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="115" y1="115" x2="155" y2="205" stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="250" y1="62"  x2="390" y2="82"  stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="250" y1="62"  x2="310" y2="162" stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="390" y1="82"  x2="430" y2="195" stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="310" y1="162" x2="430" y2="195" stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <line x1="155" y1="205" x2="310" y2="162" stroke="#4b9de8" stroke-width="1.2" stroke-dasharray="7,4"/>
      <circle cx="115" cy="115" r="14" fill="rgba(75,157,232,.45)" stroke="#4b9de8" stroke-width="1.2"/>
      <circle cx="250" cy="62"  r="14" fill="rgba(62,207,142,.5)"  stroke="#3ecf8e" stroke-width="1.5"/>
      <circle cx="390" cy="82"  r="14" fill="rgba(75,157,232,.45)" stroke="#4b9de8" stroke-width="1.2"/>
      <circle cx="310" cy="162" r="14" fill="rgba(62,207,142,.45)" stroke="#3ecf8e" stroke-width="1.2"/>
      <circle cx="155" cy="205" r="14" fill="rgba(75,157,232,.4)"  stroke="#4b9de8" stroke-width="1.2"/>
      <circle cx="430" cy="195" r="16" fill="rgba(232,147,75,.45)" stroke="#e8934b" stroke-width="1.5"/>
      <text x="115" y="119" text-anchor="middle" fill="#fff" font-size="8" font-family="monospace">N1</text>
      <text x="250" y="66"  text-anchor="middle" fill="#fff" font-size="8" font-family="monospace">N2</text>
      <text x="390" y="86"  text-anchor="middle" fill="#fff" font-size="8" font-family="monospace">N3</text>
      <text x="310" y="166" text-anchor="middle" fill="#fff" font-size="8" font-family="monospace">N4</text>
      <text x="155" y="209" text-anchor="middle" fill="#fff" font-size="8" font-family="monospace">N5</text>
      <text x="430" y="199" text-anchor="middle" fill="#fff" font-size="7" font-family="monospace">META</text>
    </svg>
  </div>

  <!-- Chrome -->
  <div class="roblox-chrome">
    <div class="rb-dot"></div><div class="rb-dot"></div><div class="rb-dot"></div>
    <div class="rb-dot"></div><div class="rb-dot"></div>
  </div>

  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="title-badge">
      <span class="icon">üìä</span>
      <div>
        <div class="name">Explorador de Grafos</div>
        <div class="sub">Zona 1 ‚Äî Estaci√≥n</div>
      </div>
    </div>
    <div class="score-strip">
      <div class="score-chip stars"><span class="ic">‚≠ê</span><div><div class="val">‚≠ê‚≠ê‚òÜ</div><div class="lbl">Estrellas</div></div></div>
      <div class="score-chip pts"><span class="ic">üèÜ</span><div><div class="val">1,250</div><div class="lbl">Puntos</div></div></div>
      <div class="score-chip money"><span class="ic">üí∞</span><div><div class="val">$340</div><div class="lbl">Dinero</div></div></div>
    </div>
    <div class="action-btns">
      <button class="action-btn restart">üîÑ Reiniciar</button>
      <button class="action-btn finish">‚úì Finalizar</button>
    </div>
  </div>

  <!-- MAIN BUTTON BAR ‚Äî solo Mapa y Misiones (Algoritmo y Matriz son propios de su modo) -->
  <div class="main-bar" id="mainBar">
    <button class="main-btn vis" id="btnMapaMain" onclick="toggleMapa()">üó∫Ô∏è Mapa</button>
    <button class="main-btn mis" onclick="toggleMissions()">üìå Misiones</button>
  </div>

  <!-- GUIDE HUD -->
  <div class="guide-hud hidden" id="guideHud">
    <div class="guide-dot"></div>
    üß≠ Dir√≠gete a: <strong>Nodo Central</strong>
  </div>

  <!-- MISSIONS -->
  <div class="missions-panel hidden" id="missionsPanel">
    <div class="missions-header">
      <span>üìã MISIONES</span>
      <div class="close-btn" onclick="toggleMissions()">‚úï</div>
    </div>
    <div class="missions-body">
      <div class="zone-label">üìç Zona 1 ‚Äî Estaci√≥n</div>
      <div class="mission-item done"><span class="m-check">‚úÖ</span><span>Conectar Nodo 1 con Nodo 2</span></div>
      <div class="mission-item done"><span class="m-check">‚úÖ</span><span>Identificar el nodo de mayor grado</span></div>
      <div class="mission-item"><span class="m-check">‚óª</span><span>Completar el recorrido BFS desde el nodo inicial</span></div>
      <div class="mission-item"><span class="m-check">‚óª</span><span>Encontrar el camino m√°s corto a META</span></div>
      <div class="bonus-sep">‚≠ê BONUS</div>
      <div class="mission-item"><span class="m-check">‚óª</span><span>Completar sin errores</span></div>
      <div class="mission-item done"><span class="m-check">‚úÖ</span><span>Explorar todos los nodos</span></div>
    </div>
  </div>

  <!-- MINIMAP (visual mode) -->
  <div class="minimap" id="minimap">
    <div class="minimap-header">Minimapa</div>
    <div class="minimap-viewport">
      <svg viewBox="0 0 200 130">
        <line x1="40" y1="65" x2="100" y2="30" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="40" y1="65" x2="60" y2="110" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="100" y1="30" x2="160" y2="45" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="100" y1="30" x2="120" y2="90" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="160" y1="45" x2="175" y2="105" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="120" y1="90" x2="175" y2="105" stroke="#4b9de8" stroke-width="1.2"/>
        <line x1="60" y1="110" x2="120" y2="90" stroke="#4b9de8" stroke-width="1.2"/>
        <circle cx="40" cy="65" r="8" fill="#4b9de8" opacity=".8"/>
        <circle cx="100" cy="30" r="9" fill="#3ecf8e" opacity=".9"/>
        <circle cx="160" cy="45" r="8" fill="#4b9de8" opacity=".8"/>
        <circle cx="120" cy="90" r="8" fill="#3ecf8e" opacity=".8"/>
        <circle cx="60" cy="110" r="8" fill="#4b9de8" opacity=".8"/>
        <circle cx="175" cy="105" r="10" fill="#e8934b" opacity=".85" stroke="#f5c842" stroke-width="1.2"/>
        <text x="40" y="68" text-anchor="middle" fill="#fff" font-size="5.5" font-family="monospace">N1</text>
        <text x="100" y="33" text-anchor="middle" fill="#fff" font-size="5.5" font-family="monospace">N2</text>
        <text x="160" y="48" text-anchor="middle" fill="#fff" font-size="5.5" font-family="monospace">N3</text>
        <text x="120" y="93" text-anchor="middle" fill="#fff" font-size="5.5" font-family="monospace">N4</text>
        <text x="60" y="113" text-anchor="middle" fill="#fff" font-size="5.5" font-family="monospace">N5</text>
        <text x="175" y="108" text-anchor="middle" fill="#fff" font-size="5" font-family="monospace">META</text>
      </svg>
    </div>
    <div class="minimap-footer" style="grid-template-columns:1fr 1fr 1fr">
      <div class="map-stat"><div class="k">Nodos</div><div class="v">6</div></div>
      <div class="map-stat"><div class="k">Aristas</div><div class="v">7</div></div>
      <div class="map-stat"><div class="k">Tipo</div><div class="v" style="font-size:9px">Dirigido</div></div>
    </div>
  </div>

  <!-- MATRIX PANEL (modo Matem√°tico) -->
  <div class="matrix-panel hidden" id="matrixPanel">
    <div class="matrix-header" style="justify-content:space-between">
      <span>üìã Matriz de Adyacencia</span>
      <div class="close-btn" onclick="setMode('visual')" title="Cerrar Matem√°tico">‚úï</div>
    </div>
    <div class="node-info">
      <div class="ni-row"><span class="k">Nodo</span><span class="v">N2</span></div>
      <div class="ni-row"><span class="k">Grado</span><span class="v">3</span></div>
      <div class="ni-row"><span class="k">Entrada</span><span class="v">1</span></div>
      <div class="ni-row"><span class="k">Salida</span><span class="v">2</span></div>
    </div>
    <div class="matrix-scroll">
      <div class="matrix-grid" style="grid-template-columns: repeat(7,24px)">
        <div class="cell" style="background:transparent"></div>
        <div class="cell header">N1</div><div class="cell header sel-row">N2</div>
        <div class="cell header">N3</div><div class="cell header">N4</div>
        <div class="cell header">N5</div><div class="cell header">MT</div>
        <div class="cell header">N1</div><div class="cell diag">‚Äî</div><div class="cell c1 sel-row">1</div><div class="cell c0">0</div><div class="cell c0">0</div><div class="cell c0">0</div><div class="cell c0">0</div>
        <div class="cell header sel-row">N2</div><div class="cell c0 sel-row">0</div><div class="cell diag sel-row">‚Äî</div><div class="cell c1 sel-row">1</div><div class="cell c1 sel-row">1</div><div class="cell c0 sel-row">0</div><div class="cell c0 sel-row">0</div>
        <div class="cell header">N3</div><div class="cell c0">0</div><div class="cell c0 sel-row">0</div><div class="cell diag">‚Äî</div><div class="cell c0">0</div><div class="cell c0">0</div><div class="cell c1">1</div>
        <div class="cell header">N4</div><div class="cell c0">0</div><div class="cell c0 sel-row">0</div><div class="cell c0">0</div><div class="cell diag">‚Äî</div><div class="cell c0">0</div><div class="cell c1">1</div>
        <div class="cell header">N5</div><div class="cell c0">0</div><div class="cell c0 sel-row">0</div><div class="cell c0">0</div><div class="cell c1">1</div><div class="cell diag">‚Äî</div><div class="cell c0">0</div>
        <div class="cell header">MT</div><div class="cell c0">0</div><div class="cell c0 sel-row">0</div><div class="cell c0">0</div><div class="cell c0">0</div><div class="cell c0">0</div><div class="cell diag">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ANALYSIS OVERLAY ‚Äî MEJORADO
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="analysis-overlay hidden" id="analysisOverlay">
    <div class="analysis-panel">

      <!-- Head: title + algorithm selector -->
      <div class="analysis-head">
        <div>
          <div class="ah-title">üéØ MODO AN√ÅLISIS</div>
          <div class="ah-sub">Zona 1 ‚Äî Estaci√≥n ¬∑ Grafo en tiempo real</div>
        </div>
        <div class="algo-pills">
          <button class="algo-pill active-bfs" id="pill-bfs" onclick="selectAlgo('bfs')">BFS</button>
          <button class="algo-pill" id="pill-dfs" onclick="selectAlgo('dfs')">DFS</button>
          <button class="algo-pill" id="pill-dijkstra" onclick="selectAlgo('dijkstra')">Dijkstra</button>
          <button class="algo-pill" id="pill-prim" onclick="selectAlgo('prim')">Prim</button>
        </div>
        <div class="spacer"></div>
        <div class="analysis-close" onclick="setMode('visual')">‚úï</div>
      </div>

      <!-- 3-column body -->
      <div class="analysis-body">

        <!-- COL 1: Graph of zone -->
        <div class="graph-col">
          <div class="graph-col-header">
            Grafo de la Zona
            <span class="zone-badge">Zona 1</span>
          </div>
          <div class="graph-canvas-wrap">
            <!-- Interactive graph SVG -->
            <svg id="zoneSVG" viewBox="0 0 240 210" style="width:100%;height:100%">
              <!-- Edges -->
              <g id="edges">
                <!-- N1‚ÜíN2 -->
                <line class="edge-path" x1="60" y1="105" x2="120" y2="50" stroke="#4b9de8" stroke-width="1.5" stroke-opacity=".5" marker-end="url(#arr)"/>
                <!-- N1‚ÜíN5 -->
                <line class="edge-path" x1="60" y1="105" x2="50" y2="170" stroke="#4b9de8" stroke-width="1.5" stroke-opacity=".5" marker-end="url(#arr)"/>
                <!-- N2‚ÜíN3 -->
                <line class="edge-path" x1="120" y1="50" x2="190" y2="65" stroke="#3ecf8e" stroke-width="2" stroke-opacity=".9" marker-end="url(#arr2)"/>
                <!-- N2‚ÜíN4 -->
                <line class="edge-path" x1="120" y1="50" x2="160" y2="140" stroke="#3ecf8e" stroke-width="2" stroke-opacity=".9" marker-end="url(#arr2)"/>
                <!-- N3‚ÜíMETA -->
                <line class="edge-path" x1="190" y1="65" x2="215" y2="165" stroke="#4b9de8" stroke-width="1.5" stroke-opacity=".5" marker-end="url(#arr)"/>
                <!-- N4‚ÜíMETA -->
                <line class="edge-path" x1="160" y1="140" x2="215" y2="165" stroke="#4b9de8" stroke-width="1.5" stroke-opacity=".5" marker-end="url(#arr)"/>
                <!-- N5‚ÜíN4 -->
                <line class="edge-path" x1="50" y1="170" x2="145" y2="148" stroke="#4b9de8" stroke-width="1.5" stroke-opacity=".5" marker-end="url(#arr)"/>
              </g>
              <!-- Arrow markers -->
              <defs>
                <marker id="arr" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                  <path d="M0,0 L0,6 L6,3 z" fill="#4b9de8" opacity=".6"/>
                </marker>
                <marker id="arr2" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                  <path d="M0,0 L0,6 L6,3 z" fill="#3ecf8e" opacity=".9"/>
                </marker>
              </defs>
              <!-- Edge weight labels -->
              <text x="93" y="73" fill="#6a7a8a" font-size="7" font-family="monospace">1</text>
              <text x="47" y="140" fill="#6a7a8a" font-size="7" font-family="monospace">2</text>
              <text x="158" y="52" fill="#3ecf8e" font-size="7" font-family="monospace">1</text>
              <text x="148" y="95" fill="#3ecf8e" font-size="7" font-family="monospace">3</text>
              <text x="208" y="115" fill="#6a7a8a" font-size="7" font-family="monospace">2</text>
              <text x="192" y="157" fill="#6a7a8a" font-size="7" font-family="monospace">1</text>
              <text x="95" y="162" fill="#6a7a8a" font-size="7" font-family="monospace">4</text>

              <!-- Nodes -->
              <!-- N1 ‚Äî visited (start) -->
              <g class="graph-node" data-node="N1" onclick="selectNode('N1')">
                <circle cx="60" cy="105" r="14" fill="rgba(62,207,142,.18)" stroke="#3ecf8e" stroke-width="2"/>
                <circle cx="60" cy="105" r="8" fill="#3ecf8e" opacity=".9"/>
                <text x="60" y="125" text-anchor="middle" fill="#3ecf8e" font-size="8" font-family="monospace" font-weight="700">N1</text>
              </g>
              <!-- N2 ‚Äî current (processing) -->
              <g class="graph-node" data-node="N2" onclick="selectNode('N2')">
                <circle cx="120" cy="50" r="18" fill="rgba(232,147,75,.15)" stroke="#e8934b" stroke-width="2.5"/>
                <circle cx="120" cy="50" r="11" fill="#e8934b" opacity=".95"/>
                <text x="120" y="70" text-anchor="middle" fill="#e8934b" font-size="8" font-family="monospace" font-weight="700">N2</text>
                <!-- pulse ring -->
                <circle cx="120" cy="50" r="18" fill="none" stroke="#e8934b" stroke-width="1" opacity=".4" style="animation:pulse-node 1.5s ease-in-out infinite"/>
              </g>
              <!-- N3 ‚Äî queued -->
              <g class="graph-node" data-node="N3" onclick="selectNode('N3')">
                <circle cx="190" cy="65" r="14" fill="rgba(75,157,232,.18)" stroke="#4b9de8" stroke-width="2" stroke-dasharray="3,2"/>
                <circle cx="190" cy="65" r="8" fill="#4b9de8" opacity=".7"/>
                <text x="190" y="84" text-anchor="middle" fill="#4b9de8" font-size="8" font-family="monospace" font-weight="700">N3</text>
              </g>
              <!-- N4 ‚Äî queued -->
              <g class="graph-node" data-node="N4" onclick="selectNode('N4')">
                <circle cx="160" cy="140" r="14" fill="rgba(75,157,232,.18)" stroke="#4b9de8" stroke-width="2" stroke-dasharray="3,2"/>
                <circle cx="160" cy="140" r="8" fill="#4b9de8" opacity=".7"/>
                <text x="160" y="158" text-anchor="middle" fill="#4b9de8" font-size="8" font-family="monospace" font-weight="700">N4</text>
              </g>
              <!-- N5 ‚Äî unvisited -->
              <g class="graph-node" data-node="N5" onclick="selectNode('N5')">
                <circle cx="50" cy="170" r="14" fill="rgba(40,50,65,.9)" stroke="rgba(106,122,138,.5)" stroke-width="1.5"/>
                <circle cx="50" cy="170" r="8" fill="rgba(106,122,138,.5)" opacity=".8"/>
                <text x="50" y="188" text-anchor="middle" fill="#6a7a8a" font-size="8" font-family="monospace" font-weight="700">N5</text>
              </g>
              <!-- META -->
              <g class="graph-node" data-node="META" onclick="selectNode('META')">
                <circle cx="215" cy="165" r="16" fill="rgba(232,147,75,.12)" stroke="#f5c842" stroke-width="2"/>
                <circle cx="215" cy="165" r="9" fill="#f5c842" opacity=".85"/>
                <text x="215" y="184" text-anchor="middle" fill="#f5c842" font-size="7" font-family="monospace" font-weight="700">META</text>
              </g>
            </svg>

            <!-- Node tooltip -->
            <div class="node-tooltip" id="nodeTooltip">
              <div class="nt-name" id="ttName">N2</div>
              <div id="ttInfo">Grado: 3 | Entrada: 1 | Salida: 2<br>Estado: <span style="color:var(--ana)">Procesando</span></div>
            </div>
          </div>

          <!-- Legend inside graph -->
          <div style="padding:5px 9px; flex-shrink:0; display:flex; gap:8px; flex-wrap:wrap;">
            <span style="font-size:8px; display:flex; align-items:center; gap:4px; color:#6a7a8a"><span style="width:7px;height:7px;border-radius:50%;background:#3ecf8e;display:inline-block"></span>Visitado</span>
            <span style="font-size:8px; display:flex; align-items:center; gap:4px; color:#6a7a8a"><span style="width:7px;height:7px;border-radius:50%;background:#e8934b;display:inline-block"></span>Actual</span>
            <span style="font-size:8px; display:flex; align-items:center; gap:4px; color:#6a7a8a"><span style="width:7px;height:7px;border-radius:50%;background:#4b9de8;display:inline-block"></span>En cola</span>
            <span style="font-size:8px; display:flex; align-items:center; gap:4px; color:#6a7a8a"><span style="width:7px;height:7px;border-radius:50%;background:#6a7a8a;display:inline-block"></span>No visitado</span>
          </div>

          <div class="graph-controls">
            <button class="graph-ctrl-btn sel">Auto</button>
            <button class="graph-ctrl-btn">Paso a paso</button>
            <button class="graph-ctrl-btn">Reset</button>
          </div>
        </div>

        <!-- COL 2: Steps + state -->
        <div class="step-col">
          <div class="step-col-header">Estado del Algoritmo ‚Äî <span id="algoNameLabel" style="color:var(--mat)">BFS</span></div>

          <!-- Traversal path -->
          <div class="path-bar" style="margin:7px 9px 0; flex-shrink:0;">
            <div class="pb-label">Recorrido actual</div>
            <div class="path-nodes">
              <span class="path-node visited">N1</span>
              <span class="path-arrow">‚Üí</span>
              <span class="path-node current">N2</span>
              <span class="path-arrow">‚Üí</span>
              <span class="path-node queued">N3</span>
              <span class="path-arrow">‚Üí</span>
              <span class="path-node queued">N4</span>
              <span class="path-arrow">‚Üí</span>
              <span class="path-node" style="color:var(--text-3); border-color:rgba(58,74,90,.5)">N5</span>
              <span class="path-arrow">‚Üí</span>
              <span class="path-node" style="color:var(--gold); border-color:rgba(245,200,66,.25); background:rgba(245,200,66,.06)">META</span>
            </div>
          </div>

          <div class="step-scroll">
            <!-- Current step card -->
            <div class="step-card">
              <div class="step-n">‚ü∂ PASO 4 / 8</div>
              Procesando nodo <strong>N2</strong> ‚Äî desencolando y explorando vecinos adyacentes: <strong>N3</strong> y <strong>N4</strong>. Ambos son no visitados ‚Üí se a√±aden a la cola.
            </div>

            <!-- State table -->
            <table class="state-table">
              <thead>
                <tr><th>Estructura</th><th>Contenido</th><th>Distancia</th></tr>
              </thead>
              <tbody id="stateTableBody">
                <tr>
                  <td style="color:var(--text-2)">Cola (Queue)</td>
                  <td><span class="hi">N3</span> ¬∑ N4 ¬∑ N5</td>
                  <td class="dim">‚Äî</td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">Visitados</td>
                  <td><span class="vis">N1</span> ¬∑ <span class="vis">N2</span></td>
                  <td class="dim">‚Äî</td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">N1</td>
                  <td><span class="vis">‚úì visitado</span></td>
                  <td><span class="vis">0</span></td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">N2</td>
                  <td><span class="vis">‚úì visitado</span></td>
                  <td><span class="vis">1</span></td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">N3</td>
                  <td><span class="hi">‚è≥ en cola</span></td>
                  <td><span class="hi">2</span></td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">N4</td>
                  <td><span class="hi">‚è≥ en cola</span></td>
                  <td><span class="hi">2</span></td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">N5</td>
                  <td><span class="dim">‚óã pendiente</span></td>
                  <td><span class="dim">‚àû</span></td>
                </tr>
                <tr>
                  <td style="color:var(--text-2)">META</td>
                  <td><span class="dim">‚óã pendiente</span></td>
                  <td><span class="dim">‚àû</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Controls + progress -->
          <div class="step-controls">
            <button class="ctrl-btn prev">‚¨Ö</button>
            <div class="step-progress"><div class="step-progress-fill" id="progressFill"></div></div>
            <button class="ctrl-btn next" id="nextBtn" onclick="nextStep()">Siguiente ‚û°</button>
            <button class="ctrl-btn exit" onclick="setMode('visual')">‚úï</button>
          </div>
        </div>

        <!-- COL 3: Pseudocode + metrics -->
        <div class="code-col">
          <div class="code-col-header">Pseudoc√≥digo ‚Äî <span id="pseudoLabel" style="color:var(--mat)">BFS</span></div>
          <div class="pseudocode" id="pseudocodeBlock">
            <!-- BFS pseudocode -->
            <div class="pc-line"><span class="pc-ln">1</span><span class="pc-code"><span class="kw">fun</span> <span class="fn">BFS</span>(grafo, inicio):</span></div>
            <div class="pc-line"><span class="pc-ln">2</span><span class="pc-code">  cola ‚Üê [inicio]</span></div>
            <div class="pc-line"><span class="pc-ln">3</span><span class="pc-code">  visitados ‚Üê {inicio}</span></div>
            <div class="pc-line"><span class="pc-ln">4</span><span class="pc-code">  dist[inicio] ‚Üê <span class="str">0</span></span></div>
            <div class="pc-line"><span class="pc-ln">5</span><span class="pc-code">&nbsp;</span></div>
            <div class="pc-line active"><span class="pc-ln">6</span><span class="pc-code">  <span class="kw">mientras</span> cola ‚â† ‚àÖ:</span></div>
            <div class="pc-line active"><span class="pc-ln">7</span><span class="pc-code">    u ‚Üê <span class="fn">desencolar</span>(cola)</span></div>
            <div class="pc-line"><span class="pc-ln">8</span><span class="pc-code">    <span class="kw">para</span> v <span class="kw">en</span> vecinos(u):</span></div>
            <div class="pc-line"><span class="pc-ln">9</span><span class="pc-code">      <span class="kw">si</span> v ‚àâ visitados:</span></div>
            <div class="pc-line"><span class="pc-ln">10</span><span class="pc-code">        <span class="fn">encolar</span>(cola, v)</span></div>
            <div class="pc-line"><span class="pc-ln">11</span><span class="pc-code">        visitados ‚Üê v</span></div>
            <div class="pc-line"><span class="pc-ln">12</span><span class="pc-code">        dist[v] ‚Üê dist[u]+<span class="str">1</span></span></div>
            <div class="pc-line"><span class="pc-ln">13</span><span class="pc-code">  <span class="kw">retornar</span> dist</span></div>
            <div class="pc-line"><span class="pc-ln">14</span><span class="pc-code"><span class="cmt">// Fin BFS</span></span></div>
          </div>

          <div class="metrics-box">
            <div style="font-size:8px; color:var(--text-2); text-transform:uppercase; letter-spacing:.1em; margin-bottom:2px;">Complejidad</div>
            <div class="complexity-badge" id="complexityBadge">O(V + E)</div>
            <div class="metric-row"><span class="mk">Pasos ejecutados</span><span class="mv orange">4 / 8</span></div>
            <div class="metric-row"><span class="mk">Nodos visitados</span><span class="mv green">2 / 6</span></div>
            <div class="metric-row"><span class="mk">Aristas exploradas</span><span class="mv">3 / 7</span></div>
            <div class="metric-row"><span class="mk">Espacio usado</span><span class="mv" style="color:var(--mat)">O(V)</span></div>
          </div>
        </div>

      </div><!-- /analysis-body -->
    </div><!-- /analysis-panel -->
  </div><!-- /analysis-overlay -->

  <!-- VICTORY -->
  <div class="victory-overlay hidden" id="victoryOverlay">
    <div class="victory-panel">
      <div class="victory-head">
        <div class="victory-title">¬°NIVEL COMPLETADO!</div>
        <div class="victory-sub">Zona 1 ‚Äî Estaci√≥n Superada</div>
        <div class="stars-row">
          <span class="star-icon">‚≠ê</span>
          <span class="star-icon">‚≠ê</span>
          <span class="star-icon dim">‚≠ê</span>
        </div>
      </div>
      <div class="victory-stats">
        <div class="stat-row"><span class="sk">‚è± Tiempo</span><span class="sv">2:34</span></div>
        <div class="stat-row"><span class="sk">üîó Conexiones</span><span class="sv" style="color:var(--ok)">7 / 7</span></div>
        <div class="stat-row"><span class="sk">‚ùå Errores</span><span class="sv" style="color:var(--danger)">2</span></div>
        <div class="stat-row"><span class="sk">üèÜ Puntaje</span><span class="sv gold">1,250</span></div>
      </div>
      <div class="victory-btns">
        <button class="v-btn repeat" onclick="setMode('visual')">üîÑ Repetir</button>
        <button class="v-btn next" onclick="setMode('visual')">Continuar ‚û°</button>
      </div>
    </div>
  </div>

  <!-- NOTIFS -->
  <div class="notif-stack hidden" id="notifStack">
    <div class="notif success">‚úÖ <span class="ni-text">¬°Misi√≥n completada!</span></div>
    <div class="notif info">üß≠ <span class="ni-text">Nueva zona desbloqueada</span></div>
  </div>

  <!-- LEGEND (visual mode) -->
  <div class="legend" id="legend">
    <div class="legend-title">Leyenda</div>
    <div class="legend-row"><div class="dot" style="background:#4b9de8"></div> Inicial</div>
    <div class="legend-row"><div class="dot" style="background:#3ecf8e"></div> Energizado</div>
    <div class="legend-row"><div class="dot" style="background:#f5c842"></div> Meta</div>
    <div class="legend-row"><div class="dot" style="background:#e8934b"></div> Adyacente</div>
    <div class="legend-row"><div class="dot" style="background:#e05c5c"></div> Aislado</div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PANTALLA DE MAPA (toggle por bot√≥n Mapa)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="map-screen hidden" id="mapScreen">

    <!-- Header con controles -->
    <div class="map-screen-header">
      <span class="map-screen-title">üó∫Ô∏è MAPA DEL NIVEL ‚Äî Zona 1</span>
      <div class="map-screen-btns">
        <button class="map-action-btn mis" onclick="toggleMissions()">üìå Misiones</button>
        <button class="map-action-btn mat" id="mapBtnMatematico" onclick="mapSwitchMatematico()">üìã Matem√°tico</button>
        <button class="map-action-btn cls" onclick="closeMapa()">‚úï Cerrar Mapa</button>
      </div>
    </div>

    <!-- Sub-info strip -->
    <div class="map-info-strip">
      <div class="map-info-pill">Nodos: <strong>6</strong></div>
      <div class="map-info-pill">Aristas: <strong>7</strong></div>
      <div class="map-info-pill">Tipo: <strong>Dirigido</strong></div>
      <div class="map-info-pill" style="margin-left:auto; color:var(--text-3); font-style:italic">Haz clic en un nodo para ver sus conexiones</div>
    </div>

    <!-- Canvas del grafo ampliado -->
    <div class="map-canvas" id="mapCanvas">
      <svg viewBox="0 0 640 420" style="width:100%;height:100%;max-width:860px;max-height:520px">
        <!-- Aristas con pesos -->
        <defs>
          <marker id="marr" markerWidth="7" markerHeight="7" refX="6" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L7,3.5 z" fill="#4b9de8" opacity=".5"/>
          </marker>
          <marker id="marr-vis" markerWidth="7" markerHeight="7" refX="6" refY="3.5" orient="auto">
            <path d="M0,0 L0,7 L7,3.5 z" fill="#3ecf8e" opacity=".8"/>
          </marker>
        </defs>
        <!-- N1‚ÜíN2 (visitada) -->
        <line x1="140" y1="210" x2="290" y2="100" stroke="#3ecf8e" stroke-width="2.5" stroke-opacity=".7" marker-end="url(#marr-vis)"/>
        <text x="208" y="148" fill="#3ecf8e" font-size="13" font-family="monospace" text-anchor="middle">1</text>
        <!-- N1‚ÜíN5 -->
        <line x1="140" y1="210" x2="120" y2="350" stroke="#4b9de8" stroke-width="2" stroke-opacity=".45" marker-end="url(#marr)"/>
        <text x="122" y="284" fill="#6a7a8a" font-size="13" font-family="monospace" text-anchor="middle">2</text>
        <!-- N2‚ÜíN3 (visitada) -->
        <line x1="310" y1="90" x2="470" y2="110" stroke="#3ecf8e" stroke-width="2.5" stroke-opacity=".7" marker-end="url(#marr-vis)"/>
        <text x="393" y="92" fill="#3ecf8e" font-size="13" font-family="monospace" text-anchor="middle">1</text>
        <!-- N2‚ÜíN4 -->
        <line x1="310" y1="105" x2="400" y2="280" stroke="#e8934b" stroke-width="2.5" stroke-opacity=".8" marker-end="url(#marr)"/>
        <text x="368" y="195" fill="#e8934b" font-size="13" font-family="monospace" text-anchor="middle">3</text>
        <!-- N3‚ÜíMETA -->
        <line x1="490" y1="120" x2="545" y2="340" stroke="#4b9de8" stroke-width="2" stroke-opacity=".45" marker-end="url(#marr)"/>
        <text x="532" y="234" fill="#6a7a8a" font-size="13" font-family="monospace" text-anchor="middle">2</text>
        <!-- N4‚ÜíMETA -->
        <line x1="420" y1="295" x2="540" y2="345" stroke="#4b9de8" stroke-width="2" stroke-opacity=".45" marker-end="url(#marr)"/>
        <text x="490" y="335" fill="#6a7a8a" font-size="13" font-family="monospace" text-anchor="middle">1</text>
        <!-- N5‚ÜíN4 -->
        <line x1="140" y1="355" x2="390" y2="305" stroke="#4b9de8" stroke-width="2" stroke-opacity=".45" marker-end="url(#marr)"/>
        <text x="265" y="345" fill="#6a7a8a" font-size="13" font-family="monospace" text-anchor="middle">4</text>

        <!-- N1 ‚Äî Visitado (inicio) -->
        <g style="cursor:pointer">
          <circle cx="140" cy="210" r="36" fill="rgba(62,207,142,.1)" stroke="#3ecf8e" stroke-width="2.5"/>
          <circle cx="140" cy="210" r="22" fill="rgba(62,207,142,.7)"/>
          <text x="140" y="205" text-anchor="middle" fill="#fff" font-size="13" font-family="monospace" font-weight="700">N1</text>
          <text x="140" y="221" text-anchor="middle" fill="rgba(255,255,255,.7)" font-size="10" font-family="monospace">Inicio</text>
          <text x="140" y="256" text-anchor="middle" fill="#3ecf8e" font-size="11" font-family="monospace">Nodo 1</text>
        </g>
        <!-- N2 ‚Äî Actual -->
        <g style="cursor:pointer">
          <circle cx="300" cy="90" r="40" fill="rgba(232,147,75,.1)" stroke="#e8934b" stroke-width="3"/>
          <circle cx="300" cy="90" r="40" fill="none" stroke="#e8934b" stroke-width="1" stroke-opacity=".3" style="animation:pulse-node 1.5s ease-in-out infinite"/>
          <circle cx="300" cy="90" r="24" fill="rgba(232,147,75,.85)"/>
          <text x="300" y="85" text-anchor="middle" fill="#fff" font-size="13" font-family="monospace" font-weight="700">N2</text>
          <text x="300" y="101" text-anchor="middle" fill="rgba(255,255,255,.7)" font-size="10" font-family="monospace">g=3</text>
          <text x="300" y="140" text-anchor="middle" fill="#e8934b" font-size="11" font-family="monospace">Nodo 2</text>
        </g>
        <!-- N3 ‚Äî En cola -->
        <g style="cursor:pointer">
          <circle cx="490" cy="110" r="36" fill="rgba(75,157,232,.1)" stroke="#4b9de8" stroke-width="2" stroke-dasharray="5,3"/>
          <circle cx="490" cy="110" r="20" fill="rgba(75,157,232,.65)"/>
          <text x="490" y="106" text-anchor="middle" fill="#fff" font-size="13" font-family="monospace" font-weight="700">N3</text>
          <text x="490" y="122" text-anchor="middle" fill="rgba(255,255,255,.7)" font-size="10" font-family="monospace">g=2</text>
          <text x="490" y="156" text-anchor="middle" fill="#4b9de8" font-size="11" font-family="monospace">Nodo 3</text>
        </g>
        <!-- N4 ‚Äî En cola -->
        <g style="cursor:pointer">
          <circle cx="410" cy="290" r="36" fill="rgba(75,157,232,.1)" stroke="#4b9de8" stroke-width="2" stroke-dasharray="5,3"/>
          <circle cx="410" cy="290" r="20" fill="rgba(75,157,232,.65)"/>
          <text x="410" y="286" text-anchor="middle" fill="#fff" font-size="13" font-family="monospace" font-weight="700">N4</text>
          <text x="410" y="302" text-anchor="middle" fill="rgba(255,255,255,.7)" font-size="10" font-family="monospace">g=2</text>
          <text x="410" y="336" text-anchor="middle" fill="#4b9de8" font-size="11" font-family="monospace">Nodo 4</text>
        </g>
        <!-- N5 ‚Äî No visitado -->
        <g style="cursor:pointer">
          <circle cx="120" cy="360" r="36" fill="rgba(40,55,75,.8)" stroke="rgba(106,122,138,.4)" stroke-width="2"/>
          <circle cx="120" cy="360" r="20" fill="rgba(80,95,115,.7)"/>
          <text x="120" y="356" text-anchor="middle" fill="rgba(255,255,255,.55)" font-size="13" font-family="monospace" font-weight="700">N5</text>
          <text x="120" y="372" text-anchor="middle" fill="rgba(255,255,255,.3)" font-size="10" font-family="monospace">g=1</text>
          <text x="120" y="406" text-anchor="middle" fill="#6a7a8a" font-size="11" font-family="monospace">Nodo 5</text>
        </g>
        <!-- META -->
        <g style="cursor:pointer">
          <circle cx="560" cy="360" r="40" fill="rgba(245,200,66,.08)" stroke="#f5c842" stroke-width="2.5"/>
          <circle cx="560" cy="360" r="24" fill="rgba(232,147,75,.6)"/>
          <text x="560" y="355" text-anchor="middle" fill="#fff" font-size="11" font-family="monospace" font-weight="700">META</text>
          <text x="560" y="370" text-anchor="middle" fill="rgba(255,255,255,.6)" font-size="9" font-family="monospace">üèÅ</text>
          <text x="560" y="410" text-anchor="middle" fill="#f5c842" font-size="11" font-family="monospace">Destino</text>
        </g>

        <!-- Leyenda del mapa -->
        <rect x="14" y="14" width="160" height="86" rx="6" fill="rgba(8,10,15,.85)" stroke="rgba(255,255,255,.08)"/>
        <text x="24" y="33" fill="#6a7a8a" font-size="9" font-family="monospace" text-transform="uppercase" letter-spacing="1">LEYENDA</text>
        <circle cx="28" cy="48" r="5" fill="#3ecf8e"/><text x="38" y="52" fill="#6a7a8a" font-size="10" font-family="monospace">Visitado</text>
        <circle cx="28" cy="65" r="5" fill="#e8934b"/><text x="38" y="69" fill="#6a7a8a" font-size="10" font-family="monospace">Actual</text>
        <circle cx="28" cy="82" r="5" fill="#4b9de8" stroke="#4b9de8" stroke-width="1" stroke-dasharray="3,2" fill-opacity=".7"/><text x="38" y="86" fill="#6a7a8a" font-size="10" font-family="monospace">En cola</text>
        <circle cx="110" cy="48" r="5" fill="rgba(80,95,115,.7)"/><text x="120" y="52" fill="#6a7a8a" font-size="10" font-family="monospace">Pendiente</text>
        <circle cx="110" cy="65" r="5" fill="#f5c842"/><text x="120" y="69" fill="#6a7a8a" font-size="10" font-family="monospace">Meta</text>
      </svg>
    </div>
  </div>

  <!-- MODE SELECTOR -->
  <div class="mode-sel">
    <button class="mode-btn active-vis" id="mVisual" onclick="setMode('visual')">
      <div class="mode-dot"></div>Visual
    </button>
    <button class="mode-btn" id="mMatrix" onclick="setMode('matematico')">
      <div class="mode-dot"></div>Matem√°tico
    </button>
    <button class="mode-btn" id="mAnalysis" onclick="setMode('analysis')">
      <div class="mode-dot"></div>An√°lisis
    </button>
  </div>

</div><!-- /viewport -->

<style>
@keyframes pulse-node {
  0%,100% { r:18; opacity:.3; }
  50% { r:24; opacity:.08; }
}
</style>

<script>
// ‚îÄ‚îÄ‚îÄ ALGORITHMS DATA ‚îÄ‚îÄ‚îÄ
const ALGOS = {
  bfs: {
    name: 'BFS',
    complexity: 'O(V + E)',
    spaceComplexity: 'O(V)',
    pseudocode: `
<div class="pc-line"><span class="pc-ln">1</span><span class="pc-code"><span class="kw">fun</span> <span class="fn">BFS</span>(grafo, inicio):</span></div>
<div class="pc-line"><span class="pc-ln">2</span><span class="pc-code">  cola ‚Üê [inicio]</span></div>
<div class="pc-line"><span class="pc-ln">3</span><span class="pc-code">  visitados ‚Üê {inicio}</span></div>
<div class="pc-line"><span class="pc-ln">4</span><span class="pc-code">  dist[inicio] ‚Üê <span class="str">0</span></span></div>
<div class="pc-line"><span class="pc-ln">5</span><span class="pc-code">&nbsp;</span></div>
<div class="pc-line active"><span class="pc-ln">6</span><span class="pc-code">  <span class="kw">mientras</span> cola ‚â† ‚àÖ:</span></div>
<div class="pc-line active"><span class="pc-ln">7</span><span class="pc-code">    u ‚Üê <span class="fn">desencolar</span>(cola)</span></div>
<div class="pc-line"><span class="pc-ln">8</span><span class="pc-code">    <span class="kw">para</span> v <span class="kw">en</span> vecinos(u):</span></div>
<div class="pc-line"><span class="pc-ln">9</span><span class="pc-code">      <span class="kw">si</span> v ‚àâ visitados:</span></div>
<div class="pc-line"><span class="pc-ln">10</span><span class="pc-code">        <span class="fn">encolar</span>(cola, v)</span></div>
<div class="pc-line"><span class="pc-ln">11</span><span class="pc-code">        visitados ‚Üê v</span></div>
<div class="pc-line"><span class="pc-ln">12</span><span class="pc-code">        dist[v] ‚Üê dist[u]+<span class="str">1</span></span></div>
<div class="pc-line"><span class="pc-ln">13</span><span class="pc-code">  <span class="kw">retornar</span> dist</span></div>
<div class="pc-line"><span class="pc-ln">14</span><span class="pc-code"><span class="cmt">// Fin BFS</span></span></div>`
  },
  dfs: {
    name: 'DFS',
    complexity: 'O(V + E)',
    spaceComplexity: 'O(V)',
    pseudocode: `
<div class="pc-line"><span class="pc-ln">1</span><span class="pc-code"><span class="kw">fun</span> <span class="fn">DFS</span>(grafo, inicio):</span></div>
<div class="pc-line"><span class="pc-ln">2</span><span class="pc-code">  pila ‚Üê [inicio]</span></div>
<div class="pc-line"><span class="pc-ln">3</span><span class="pc-code">  visitados ‚Üê {}</span></div>
<div class="pc-line"><span class="pc-ln">4</span><span class="pc-code">&nbsp;</span></div>
<div class="pc-line active"><span class="pc-ln">5</span><span class="pc-code">  <span class="kw">mientras</span> pila ‚â† ‚àÖ:</span></div>
<div class="pc-line active"><span class="pc-ln">6</span><span class="pc-code">    u ‚Üê <span class="fn">desapilar</span>(pila)</span></div>
<div class="pc-line"><span class="pc-ln">7</span><span class="pc-code">    <span class="kw">si</span> u ‚àâ visitados:</span></div>
<div class="pc-line"><span class="pc-ln">8</span><span class="pc-code">      visitados ‚Üê u</span></div>
<div class="pc-line"><span class="pc-ln">9</span><span class="pc-code">      <span class="kw">para</span> v <span class="kw">en</span> vecinos(u):</span></div>
<div class="pc-line"><span class="pc-ln">10</span><span class="pc-code">        <span class="kw">si</span> v ‚àâ visitados:</span></div>
<div class="pc-line"><span class="pc-ln">11</span><span class="pc-code">          <span class="fn">apilar</span>(pila, v)</span></div>
<div class="pc-line"><span class="pc-ln">12</span><span class="pc-code">  <span class="kw">retornar</span> visitados</span></div>
<div class="pc-line"><span class="pc-ln">13</span><span class="pc-code"><span class="cmt">// Explora en profundidad</span></span></div>`
  },
  dijkstra: {
    name: 'Dijkstra',
    complexity: 'O((V+E) log V)',
    spaceComplexity: 'O(V)',
    pseudocode: `
<div class="pc-line"><span class="pc-ln">1</span><span class="pc-code"><span class="kw">fun</span> <span class="fn">Dijkstra</span>(grafo, inicio):</span></div>
<div class="pc-line"><span class="pc-ln">2</span><span class="pc-code">  dist[v] ‚Üê ‚àû <span class="kw">para</span> todo v</span></div>
<div class="pc-line"><span class="pc-ln">3</span><span class="pc-code">  dist[inicio] ‚Üê <span class="str">0</span></span></div>
<div class="pc-line"><span class="pc-ln">4</span><span class="pc-code">  PQ ‚Üê {(0, inicio)}</span></div>
<div class="pc-line"><span class="pc-ln">5</span><span class="pc-code">&nbsp;</span></div>
<div class="pc-line active"><span class="pc-ln">6</span><span class="pc-code">  <span class="kw">mientras</span> PQ ‚â† ‚àÖ:</span></div>
<div class="pc-line active"><span class="pc-ln">7</span><span class="pc-code">    (d, u) ‚Üê <span class="fn">extraerMin</span>(PQ)</span></div>
<div class="pc-line"><span class="pc-ln">8</span><span class="pc-code">    <span class="kw">para</span> (v, w) <span class="kw">en</span> vecinos(u):</span></div>
<div class="pc-line"><span class="pc-ln">9</span><span class="pc-code">      alt ‚Üê dist[u] + w</span></div>
<div class="pc-line"><span class="pc-ln">10</span><span class="pc-code">      <span class="kw">si</span> alt &lt; dist[v]:</span></div>
<div class="pc-line"><span class="pc-ln">11</span><span class="pc-code">        dist[v] ‚Üê alt</span></div>
<div class="pc-line"><span class="pc-ln">12</span><span class="pc-code">        PQ ‚Üê (alt, v)</span></div>
<div class="pc-line"><span class="pc-ln">13</span><span class="pc-code">  <span class="kw">retornar</span> dist</span></div>
<div class="pc-line"><span class="pc-ln">14</span><span class="pc-code"><span class="cmt">// Camino m√°s corto pesado</span></span></div>`
  },
  prim: {
    name: 'Prim (MST)',
    complexity: 'O(E log V)',
    spaceComplexity: 'O(V)',
    pseudocode: `
<div class="pc-line"><span class="pc-ln">1</span><span class="pc-code"><span class="kw">fun</span> <span class="fn">Prim</span>(grafo, raiz):</span></div>
<div class="pc-line"><span class="pc-ln">2</span><span class="pc-code">  key[v] ‚Üê ‚àû <span class="kw">para</span> todo v</span></div>
<div class="pc-line"><span class="pc-ln">3</span><span class="pc-code">  key[raiz] ‚Üê <span class="str">0</span></span></div>
<div class="pc-line"><span class="pc-ln">4</span><span class="pc-code">  padre[raiz] ‚Üê nulo</span></div>
<div class="pc-line"><span class="pc-ln">5</span><span class="pc-code">  PQ ‚Üê todos los nodos</span></div>
<div class="pc-line active"><span class="pc-ln">6</span><span class="pc-code">  <span class="kw">mientras</span> PQ ‚â† ‚àÖ:</span></div>
<div class="pc-line active"><span class="pc-ln">7</span><span class="pc-code">    u ‚Üê <span class="fn">extraerMin</span>(PQ)</span></div>
<div class="pc-line"><span class="pc-ln">8</span><span class="pc-code">    <span class="kw">para</span> (v, w) <span class="kw">en</span> vecinos(u):</span></div>
<div class="pc-line"><span class="pc-ln">9</span><span class="pc-code">      <span class="kw">si</span> v ‚àà PQ <span class="kw">y</span> w &lt; key[v]:</span></div>
<div class="pc-line"><span class="pc-ln">10</span><span class="pc-code">        padre[v] ‚Üê u</span></div>
<div class="pc-line"><span class="pc-ln">11</span><span class="pc-code">        key[v] ‚Üê w</span></div>
<div class="pc-line"><span class="pc-ln">12</span><span class="pc-code">  <span class="kw">retornar</span> padre</span></div>
<div class="pc-line"><span class="pc-ln">13</span><span class="pc-code"><span class="cmt">// √Årbol de expansi√≥n m√≠nima</span></span></div>`
  }
};

let currentMode = 'visual';   // 'visual' | 'matematico' | 'analysis' | 'victory'
let mapaOpen    = false;      // pantalla de Mapa abierta
let currentAlgo = 'bfs';
let currentStep = 4;
let totalSteps  = 8;
let missionsOpen = false, guideActive = false, notifsActive = false;

// ‚îÄ‚îÄ‚îÄ RENDER DE VISIBILIDAD CENTRAL ‚îÄ‚îÄ‚îÄ
// Reglas:
//   minimap       ‚Üí solo en Visual SIN mapa abierto
//   matrixPanel   ‚Üí en Matem√°tico (con o sin mapa)
//   mapScreen     ‚Üí cuando mapaOpen=true (visual o matem√°tico)
//   mainBar       ‚Üí visible en visual/matem√°tico y mapa CERRADO
//   legend        ‚Üí solo en Visual sin mapa
//   mapCanvas     ‚Üí con padding-right si matem√°tico+mapa (para evitar solapamiento)
function applyVisibility() {
  const isVisual = currentMode === 'visual';
  const isMat    = currentMode === 'matematico';
  const isAna    = currentMode === 'analysis';
  const isVic    = currentMode === 'victory';

  // Minimap: Visual y mapa cerrado
  document.getElementById('minimap').classList.toggle('hidden', !(isVisual && !mapaOpen));

  // Matrix: Matem√°tico (con o sin mapa)
  document.getElementById('matrixPanel').classList.toggle('hidden', !isMat);

  // Map screen: cuando mapaOpen activo
  document.getElementById('mapScreen').classList.toggle('hidden', !mapaOpen || isAna || isVic);

  // Main bar: visible en visual/mat, pero NO cuando mapa abierto ni en an√°lisis/victoria
  document.getElementById('mainBar').classList.toggle('hidden', mapaOpen || isAna || isVic);

  // Overlays
  document.getElementById('analysisOverlay').classList.toggle('hidden', !isAna);
  document.getElementById('victoryOverlay').classList.toggle('hidden', !isVic);

  // Legend: solo en visual sin mapa
  document.getElementById('legend').classList.toggle('hidden', !(isVisual && !mapaOpen));

  // Map canvas padding cuando matem√°tico+mapa (espacio para la matriz)
  const mapCanvas = document.getElementById('mapCanvas');
  if (mapCanvas) mapCanvas.classList.toggle('with-matrix', isMat && mapaOpen);

  // Bot√≥n Matem√°tico del mapa: deshabilitar si ya est√° en ese modo
  const mapBtnMat = document.getElementById('mapBtnMatematico');
  if (mapBtnMat) {
    mapBtnMat.style.opacity = isMat ? '.45' : '1';
    mapBtnMat.style.pointerEvents = isMat ? 'none' : '';
  }

  // Mode selector buttons
  const mv = document.getElementById('mVisual');
  const mm = document.getElementById('mMatrix');
  const ma = document.getElementById('mAnalysis');
  mv.className = 'mode-btn' + (isVisual   ? ' active-vis' : '');
  mm.className = 'mode-btn' + (isMat      ? ' active-mat' : '');
  ma.className = 'mode-btn' + (isAna      ? ' active-ana' : '');

  // Meta buttons
  document.querySelectorAll('.meta-btn').forEach(b => b.classList.remove('active'));
  const metaMap = { visual:'Visual', matematico:'Matem√°tico', analysis:'An√°lisis', victory:'Victoria' };
  document.querySelectorAll('.meta-btn').forEach(b => {
    if (b.textContent.trim().includes(metaMap[currentMode] || '')) b.classList.add('active');
    if (mapaOpen && b.textContent.includes('Mapa')) b.classList.add('active');
  });
}

// ‚îÄ‚îÄ‚îÄ MODE SWITCHING ‚îÄ‚îÄ‚îÄ
function setMode(mode) {
  // Al cambiar a an√°lisis/victoria cerramos el mapa
  if (mode === 'analysis' || mode === 'victory') mapaOpen = false;
  currentMode = mode;
  applyVisibility();
}

// ‚îÄ‚îÄ‚îÄ MAPA TOGGLE ‚îÄ‚îÄ‚îÄ
function toggleMapa() {
  mapaOpen = !mapaOpen;
  applyVisibility();
}
function closeMapa() {
  mapaOpen = false;
  applyVisibility();
}
// Desde el bot√≥n Matem√°tico dentro del mapa
function mapSwitchMatematico() {
  currentMode = 'matematico';
  applyVisibility();
}

// ‚îÄ‚îÄ‚îÄ ALGO SELECTOR ‚îÄ‚îÄ‚îÄ
function selectAlgo(algo) {
  currentAlgo = algo;
  currentStep = 1;
  totalSteps  = 8;

  // Update pills
  ['bfs','dfs','dijkstra','prim'].forEach(a => {
    const p = document.getElementById('pill-' + a);
    p.className = 'algo-pill' + (a === algo ? ' active-' + a : '');
  });

  // Update pseudocode
  document.getElementById('pseudocodeBlock').innerHTML = ALGOS[algo].pseudocode;
  document.getElementById('pseudoLabel').textContent = ALGOS[algo].name;
  document.getElementById('algoNameLabel').textContent = ALGOS[algo].name;
  document.getElementById('complexityBadge').textContent = ALGOS[algo].complexity;
  updateProgress();
}

// ‚îÄ‚îÄ‚îÄ STEP NAVIGATION ‚îÄ‚îÄ‚îÄ
function nextStep() {
  if(currentStep < totalSteps) {
    currentStep++;
    updateProgress();
  }
}
function updateProgress() {
  const pct = (currentStep / totalSteps * 100).toFixed(0);
  document.getElementById('progressFill').style.width = pct + '%';
}

// ‚îÄ‚îÄ‚îÄ NODE CLICK (graph) ‚îÄ‚îÄ‚îÄ
function selectNode(name) {
  const tooltip = document.getElementById('nodeTooltip');
  const ttName  = document.getElementById('ttName');
  const ttInfo  = document.getElementById('ttInfo');
  const nodeData = {
    N1:   { deg:1, in:0, out:1, state:'<span style="color:var(--vis)">‚úì Visitado</span>' },
    N2:   { deg:3, in:1, out:2, state:'<span style="color:var(--ana)">‚ü≥ Procesando</span>' },
    N3:   { deg:2, in:1, out:1, state:'<span style="color:var(--mat)">‚è≥ En cola</span>' },
    N4:   { deg:2, in:1, out:1, state:'<span style="color:var(--mat)">‚è≥ En cola</span>' },
    N5:   { deg:2, in:1, out:1, state:'<span style="color:var(--text-3)">‚óã Pendiente</span>' },
    META: { deg:2, in:2, out:0, state:'<span style="color:var(--gold)">üéØ Destino</span>' }
  };
  const d = nodeData[name];
  ttName.textContent = name;
  ttInfo.innerHTML = `Grado: ${d.deg} | Entrada: ${d.in} | Salida: ${d.out}<br>Estado: ${d.state}`;
  tooltip.style.display = 'block';
  setTimeout(() => { tooltip.style.display = 'none'; }, 3000);
}

// ‚îÄ‚îÄ‚îÄ TOGGLE PANELS ‚îÄ‚îÄ‚îÄ
function toggleMissions() {
  missionsOpen = !missionsOpen;
  document.getElementById('missionsPanel').classList.toggle('hidden', !missionsOpen);
  document.getElementById('btnMissions').classList.toggle('active', missionsOpen);
}
function toggleGuide() {
  guideActive = !guideActive;
  document.getElementById('guideHud').classList.toggle('hidden', !guideActive);
  document.getElementById('btnGuide').classList.toggle('active', guideActive);
}
function toggleNotifs() {
  notifsActive = !notifsActive;
  document.getElementById('notifStack').classList.toggle('hidden', !notifsActive);
  document.getElementById('btnNotif').classList.toggle('active', notifsActive);
}

applyVisibility();
updateProgress();
</script>
</body>
</html>